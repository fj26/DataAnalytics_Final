---
output: 
  pdf_document:
    keep_tex: yes
    fig_caption: yes
    number_sections: yes
geometry: margin=2.54cm
title: "Factors and Impacts of Greenhouse Gas Emissiosn in US from 1990-2017"
subtitle: "Web address for GitHub repository"
author: "Vicky Jia"
fontsize: 12pt
mainfont: Times New Roman
editor_options: 
  chunk_output_type: console
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
setwd("~/DataAnalytics_Final")
library(tidyverse)
library(cowplot)
library(lubridate)
library(zoo)
library(knitr)
library(kableExtra)
library(viridis)
library(agricolae)
library(corrplot)
library(trend)
library(modifiedmk)

projecttheme <- theme_light() + 
  theme(
    plot.title = element_text(color = 'dimgray', size = 12, face = 'bold'), 
    axis.text = element_text(color = "black", size= 10), 
    axis.title = element_text(color = 'black', size = 11, face = 'bold'),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.text = element_text(size = 10),
    legend.position = "bottom")
theme_set(projecttheme)

GDP <- read.csv('./Raw Data/BEA_GDP_raw.csv')
electric <- read.csv('./Raw Data/EIA_electricity-consumption_sector_raw.csv')
GHG.gas <- read.csv('./Raw Data/EPA_GHG_Gas_raw.csv')
GHG.sector <- read.csv('./Raw Data/EPA_GHG_Sector_raw.csv')
temp <- read.csv('./Raw Data/NOAA_temp_raw.csv')
ppl <- read.csv('./Raw Data/WB_pop_raw.csv')
structure <- read.csv('./Processed Data/Processed_Data_Structure.csv')

```


#Rationale and Research Questions

Global warming resulted from greenhouse gas (GHG) emissions is one of the biggest challenges to human beings. While IPCC in its latest special report warns people the critial consequences of 1.5-degree-Celcius temperature increase from the pre-industrial level, the average global temperature on Earth has already increased by about 0.8° Celsius (1.4° Fahrenheit) since 1880. 

In the United States, in the period of 1990-2017, the temperature increase and GHG emissions have been greatly contributed by the energy sector. This was attributed to the increase electricity consumptions in all sectors by more people, and electricity generation primarily relies on fossil-fuel combustions. In addition to temperature increase, the economic features also have significant changes along the increasing GHG emissions and electricity consumption in the meantime. Understanding environmental and socioeconomic impacts of GHG emissions is significant to policy makers to consider long-term decision making. Therefore, this project examines the impacts of energy consumptions and demographic changes on GHG emissions, as well as further investigates the environmental and economic effects of GHG emissions in the United States from 1990 to 2017. 

Specifically, this project aims to study factors that might contribute to GHG emissions guided by the following questions:

1. What were impacts of US electricity consumption changes on GHG emissions from 1990 to 2017? What sectors of electricity econsumption were significant to total GHG emissions in these 28 years?
2. Was the population growth a signifant factor in affecting GHG emissisions in this period?

Following up with GHG emission causes, this project will then explore the impacts of GHG emissions in US from 1990 to 2017 guided by the following questions: 

3. Which sectors were more significant to temperature anomalies in this period?
4. Was the economic development in this period, namely gross domestic product (GDP) and personal consumption expenditures, significantly realted to the GHG emissions? 

\newpage

#Dataset Information

## Raw Database Information
There were 6 datasets used in this project retrieved from various websites. Detailed criteria to collect these raw data in csv file format are listed below. 

### BEA_GDP_raw.csv:
US annual gross domestic production and personal consumption expenditures data from 1990-2017.Data were retrieved from US Bureau of Economic Analysis National Income and Product Accounts (NIPA) Interactive Data Tables tool. Data were transposed by the investigator.       
(https://apps.bea.gov/iTable/iTable.cfm?reqid=19&step=2#reqid=19&step=2&isuri=1&1921=survey accessed on 2020-04-11.)

The following selections were made:       
*First Year: 1990-A&Q       
*Last Year: 2017-A&Q        
*Scale: billion           
*Series: Annual


### EIA_electricity-consumption_sector_raw.csv:
The annual retail sales of electricity to ultimate customers by sector, by state, by provider from 1990 to 2018 in US. The data was retrieved from Annual Electric Power Industry Report, Form EIA-861 detailed data files from US Energy Information Administration.

(https://www.eia.gov/electricity/data/state/sales_annual.xlsx accessed on 2020-04-11.)


### EPA_GHG_Gas_raw.csv:
US GHG emission data by gas types in all sectors from 1990-2017 provided by EPA's annual Inventory of U.S. Greenhouse Gas Emissions and Sinks. Data was retrieved from US EPA Greenhouse Gas Inventory Data Explorer. Data were transposed by the investigator.       
(https://cfpub.epa.gov/ghgdata/inventoryexplorer/#allsectors/allgas/gas/all accessed on 2020-04-11.)

The following selections were made:         
*Sector: All sectors          
*Greenhouse gas: All gases        
*Break out by: Gas        
*Year: All years


### EPA_GHG_Sector_raw.csv:
GHG emission data by economic sectors for all greenhouse gases from 1990-2017 provided by EPA's annual Inventory of U.S. Greenhouse Gas Emissions and Sinks. Data was retrieved from US EPA Greenhouse Gas Inventory Data Explorer. Data were transposed by the investigator.        
(https://cfpub.epa.gov/ghgdata/inventoryexplorer/#allsectors/allgas/econsect/all accessed on 2020-04-11.)

The following selections were made: 
*Sector: All sectors          
*Greenhouse gas: All gases        
*Break out by: Economic sector        
*Year: All years


### NOAA_temp_raw.csv:
US mean annual temperature and temperature anomalies from 1990 to 2017. Data was retrieved from NOAA National Centers for Environmental Information Climate at a Glance.       
(https://www.ncdc.noaa.gov/cag/national/time-series/110/tavg/ann/12/1990-2017?base_prd=true&begbaseyear=1901&endbaseyear=2000, accessed on 2020-04-11.)

The following selections were made:       
*Parameter: Average Temperature       
*Time Scale: Annual         
*Start Year: 1990         
*End Year: 2017         
*Display Base Period: Start: 1990, End: 2017        


### WB_pop_raw.csv:
Total annual population data from 1960-2018 retrieved from World Bank dataset. Data were transposed by the investigator.       
(https://data.worldbank.org/indicator/SP.POP.TOTL?locations=US accessed on 2020-04-11.)

The following selections were made in the searching window:       
*Population, total          
*United States

## Data Structure
The raw data collected from some databases are beyond the scope of this project, so these datasets were wrangled to fit to the objective of this project. To provide of an overview of the data structure of each raw dataset, raw data were reorganized by gathering same types of data to one column together. Table 1 summarzies the data structure for all raw datasets used in this project after being gathered These datasets are saved in "Processed Data" folder.

The specific content of each dataset and the detailed process of reframing each raw dataset to meet the objective of this project are introduced in Chapter 3, Exploratory Analysis. 
```{r echo = FALSE, message = FALSE, warning = FALSE}
GDPraw.gather <- gather(GDP, 'Type', 'Value', -Year)
write.csv(GDPraw.gather, row.names = FALSE, file = './Processed Data/BEA_GDP_structure.csv')
elecraw.gather <- gather(electric, 'Sector', 'Electricity_Consumption', Residential:Total)
write.csv(elecraw.gather, row.names = FALSE, file = './Processed Data/EIA_electricity-consumption_sector_structure.csv')
GHG.gas.raw.gather <- gather(GHG.gas, 'Gas', 'Concentration', -Year)
write.csv(GHG.gas.raw.gather, row.names = FALSE, file = './Processed Data/EPA_GHG_Gas_structure.csv')
GHG.sector.raw.gather <- gather(GHG.sector, 'Sector', 'Emission', -Year)
write.csv(GHG.sector.raw.gather, row.names = FALSE, file = './Processed Data/EPA_GHG_Sector_structure.csv')
write.csv(temp, row.names = FALSE, file = './Processed Data/NOAA_temp_structure.csv')
ppl.raw.gather <- gather(ppl, 'Country', 'Population', -Year)
write.csv(ppl.raw.gather, row.names = FALSE, file = './Processed Data/WB_pop_structure.csv')

kable(structure, caption = "Summary of Data Structure ") %>%
  kable_styling(latex_options="scale_down")
```

\newpage

# Exploratory Analysis 
Some raw datasets are at global scale, or have longer temporal ranges, which are beyond the scope of this project. Also, some discrete variables were downloaded as characters, which could not be adopted by some statistical models. Therefore, thse datasets were first wrangled to focus on US region in the period between 1990 and 2017. This section demonsrates the process of data wrangling in details, as well as presents the overview of the content of each dataset.

##US GDP
```{r warning = FALSE}
#Show the structure of the raw dataset
str(GDP)

#Rename column name for easier use
GDP <- GDP %>%
  rename('GDP' = 'Gross.domestic.product', 'Personal_consumption' = 'Personal.consumption.expenditures')

##Reframe dataset to meet project objective
GDP.select<- GDP %>%
  filter(Year>1989 & Year < 2018) %>%
  select(Year, GDP, Personal_consumption)
dim(GDP.select)

```

Figure 1 illustartes the trend of change of US GDP and personal consumptions over the years. Generally, GDP growth was increasing in most years, though slowing down at the beginning of the 21st century and decreasing in 2008-2009 when financial crisis ocurred. The changing trend of personal consumptions over the years was generally consistent to GDP growth, as the personal consumption is one of variables accounted to total GDP. Therefore, from this overview of the dataset, the variable of personal consumption would not be considered as an unique and significant variable to conduct additional analysis. Instead, in economic development analysis in Chapter 4, only total GDP will be studied.

```{r echo = FALSE, message = FALSE, warning = FALSE, fig.cap= 'US Economic Features in 1990-2017'}
#kable(head(GDP.select), caption = "First 6 rows of GDP and personal consumption (billion US$)") %>%
 # kable_styling(latex_options="hold_position")

#Gather dataset together for visualization
GDP.gather <- gather(GDP.select, 'Type', 'Value', -Year)
count(GDP.gather)

GDP.line <- ggplot(GDP.gather)+
  geom_line(aes(x= Year, y=Value, color = Type))+
  labs(y= 'US$ (billion)',
       color = '')+
  scale_color_brewer(type='qual', direction = -1)+
  scale_x_continuous("Year", labels = as.character(GDP.gather$Year), breaks = GDP.gather$Year)
print(GDP.line)
```

\newpage

##US Electricity Consumption
There are three types of industry sector in the raw dataset. This project focuses on "Total Electric Industry", which includes all types of survices in electricity consumption in each sector. There are four sectors covered in the electricity consumption dataset, which are illustrateed as Table ???. The values of consumption data are in factor format and separted by commas, so it is necessary to convert these values to numeric variables first. By visualizing electricity consumption data in Figure 2, we can notice that all four graphs are in different consumption scales. Notably, transportation sector has the lowest electricity consumption among all sectors, and also there was no data available for transportation sector in before 2002. Therefore, transporation sector will be filtered out in the next step statistic analysis.

```{r warning = FALSE}
#Show the structure of the raw dataset
str(electric)

#Rename column name for easier use
electric <- electric %>%
  rename('Industry_Sector' = Industry.Sector.Category, 'elec_residential' = Residential, 'elec_commercial' = Commercial, 'elec_industrial' = Industrial, 'elec_transport' =Transportation)
colnames(electric)

##Reframe dataset to meet project objective
elec.select <- electric %>%
  filter(State == 'US'& Year>1989 & Year < 2018 & Industry_Sector == 'Total Electric Industry')%>%
  select(Year, elec_residential, elec_commercial, elec_industrial, elec_transport) 
dim(elec.select)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap='US Electricty Consumption by Sector in 1990-2017'}
#The preview of reframed dataset
kable(head(elec.select), caption = "First 6 rows of electricity consumptions by sector in US (Mwh)") %>%
  kable_styling(latex_options="hold_position")

#Gather dataset together for visualization
elec.gather <- gather(elec.select, 'Sector', 'Electricity_Consumption', -Year)
count(GDP.gather)

#Convert to numeric variables
elec.gather$Electricity_Consumption <- str_replace_all(elec.gather$Electricity_Consumption,
pattern = "([,])", replacement = "")
elec.gather$Electricity_Consumption <- as.numeric(elec.gather$Electricity_Consumption)
str(elec.gather)

#Remove NA data
elec.gather2 <- elec.gather %>%
  filter(!is.na(Electricity_Consumption))

elec.line <- ggplot(elec.gather2)+
  geom_line(aes(x= Year, y=Electricity_Consumption, color=Sector))+
  labs(y= 'Electricity Consumption (Mwh)',
       color = '')+
  scale_color_brewer(palette = 'Set1')+
  facet_wrap(vars(Sector), scales = 'free')+
  theme(legend.position = "none") 
print(elec.line)

```

\newpage

##US GHG Concentration by Gas
GHG concentration data indicates the concentration of different GHG gases emitted to the atmosphere. The upper graph in Figure 3 displays the trends for all GHGs together, from which we can see CO2 was the major GHG emitted by human beings. To observe the trend of change more clearly, graphs below show the concentration over years for each GHG. It is hard to summarize the general trend for all GHG emissions, so in the further analysis, the GHG type comparison will be first studied. 

```{r warning=FALSE}
#Show the structure of the raw data
str(GHG.gas)

#Rename column name for easier use
colnames(GHG.gas)
GHG.gas <- GHG.gas %>%
  rename("CO2" = Carbon.dioxide, 'CH4' = Methane, 'N2O' = Nitrous.oxide, 'Fgas' = Fluorinated.gases)
colnames(GHG.gas)

```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= 'US GHG Concentration by Gas Type in 1990-2017 (MMTCO2e)', fig.height=8, fig.width=7}
#Preview of reframed dataset
kable(head(GHG.gas), caption = "First 6 years of GHG emissions by gas type (MMTCO2e)") %>%
  kable_styling(latex_options="hold_position")

#Gather dataset together for visualization
GHG.gas.gather <- gather(GHG.gas, 'Gas', 'Concentration', -Year)
count(GHG.gas.gather)

GHG.gas.line <- ggplot(GHG.gas.gather)+
  geom_line(aes(x= Year, y=Concentration, color = Gas))+
  labs(y= bquote(bold('Concentration (MMT'~CO[2]~'e)')),
       color = '')+
  scale_color_brewer(palette = 'Set1')+
  scale_x_continuous("Year", labels = as.character(GHG.gas.gather$Year), breaks = GHG.gas.gather$Year)

GHG.gas.line.facet <- ggplot(GHG.gas.gather)+
  geom_line(aes(x= Year, y=Concentration, color = Gas))+
  labs(y= bquote(bold('Concentration (MMT'~CO[2]~'e)')),
       color = '')+
  scale_color_brewer(palette = 'Set1')+
  facet_wrap(vars(Gas), scales = 'free')+
  theme(legend.position = "none")

plot_grid(GHG.gas.line,
          GHG.gas.line.facet,
          label_x = 0.2,
          nrow = 2)
```

\newpage

##US GHG Emissions by Sector
Figure 4 illustrates the GHG emissions over the same period by sector. The ideology of Figure 4 is same as Figure 3, which internally compares the emissions by sectors. The total sectoral GHG emission is same as the sum of GHG concentration by gas type. Among all 6 sectors emitting GHGs, electricity generation, transporation, and industial sector had highest emissions. It is inspired to study how sectoral emissions had contributed to total GHG emissions, and how they were different from each other.

```{r warning=FALSE}
str(GHG.sector)

#Rename column name for easier use
colnames(GHG.sector)
GHG.sector <- GHG.sector %>%
  rename('Electricity_generation' = Electricity.generation)
colnames(GHG.sector)

##Reframe dataset to meet project objective
GHG.sector.select <- GHG.sector %>%
  select(Year, Transportation, Electricity_generation, Industry, Agriculture, Commercial,Residential)
dim(GHG.sector.select)

```

```{r echo = FALSE, message=FALSE, warning=FALSE}
#Preview of reframed dataset
kable(head(GHG.sector.select), caption = "First 6 years of GHG emissions by sector (MMTCO2e)") %>%
  kable_styling(latex_options="hold_position")
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= 'US GHG Emissions by Sector in 1990-2017 (MMTCO2e)', fig.height=8, fig.width=7}

#Gather dataset together for visualization
GHG.sector.gather <- gather(GHG.sector.select, 'Sector', 'Emission', -Year)
count(GHG.sector.gather)

GHG.sector.line <- ggplot(GHG.sector.gather)+
  geom_line(aes(x= Year, y=Emission, color = Sector))+
  labs(y= bquote(bold('GHG Emission (MMT'~CO[2]~'e)')),
       color = '')+
  scale_color_brewer(palette = 'Dark2')+
  scale_x_continuous("Year", labels = as.character(GHG.sector.gather$Year), breaks = GHG.sector.gather$Year)

GHG.sector.line.facet <- ggplot(GHG.sector.gather)+
  geom_line(aes(x= Year, y=Emission, color = Sector))+
  labs(y= bquote(bold('GHG Emission (MMT'~CO[2]~'e)')),
       color = '')+
  scale_color_brewer(palette = 'Dark2')+
  facet_wrap(vars(Sector), scales = 'free')+
  theme(legend.position = "none")

plot_grid(GHG.sector.line,
          GHG.sector.line.facet,
          label_x = 0.2,
          nrow = 2)
```


\newpage

##US Mean Annual Temperature

Mean annual temperature and temperature anomalies over 1990-2017 are visualized in Figure 5. Temperature anomaly refers to the difference between annual mean temperature and overall averaage temperature for that period. Therefore, the overall average temperature were also calculated and mutated as a new column in the table. Since overall average temperature is constant, temperature anomalies are in the same changing trends as annual mean temperature. Since temperature anomalies are referene values, they can better and more easily demonstrate increasing and decreasing trend by positive and negative symbols. Therefore, temperature anomaly will be used in the future analyses.
```{r warning=FALSE}
str(temp)
#Convert year characters to date format
colnames(temp)
temp <- mutate(temp, Year = year(as.Date(as.yearmon(as.character(temp$Date), format = "%Y%m"))))
str(temp)

#Reframe dataset to meet project objective
temp.select <- temp %>%
  select(Year, Value, Anomaly) %>%
  mutate(Mean_all_temp =  mean(Value))
dim(temp.select)
str(temp.select)

```

```{r echo = FALSE, message=FALSE, warning=FALSE}
#Preview of reframed dataset
kable(head(temp.select), caption = "First 6 years of US temperature data in 1990-2017 (F)") %>%
  kable_styling(latex_options="hold_position")

```

```{r echo = FALSE, message=FALSE, warning=FALSE,fig.cap= "US Mean Annual Temperature Anomaly in 1990-2017 (F)"}
temp.line <- ggplot(temp.select, aes(x= Year, y=Value))+
  geom_point()+
  geom_line()+
  geom_line(aes(y=Mean_all_temp, color= 'red'))+
  labs(y= expression("Temperature ("*~degree*F*")"),
       title = expression("US Mean Annual Temperature in 1990-2017 ("*~degree*F*")"))+
  scale_x_continuous("Year", labels = as.character(temp.select$Year), breaks = temp.select$Year)+
  geom_text(x = 2017, y = 53, label = "Average Temperature for 28 Years", hjust = 1, size = 3, color = 'red')+
  theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x = element_blank())

temp.select$colour <- ifelse(temp.select$Anomaly < 0, "negative","positive")
temp.anom <- ggplot(temp.select)+
  geom_col(aes(x=Year, y=Anomaly, fill=colour))+
  labs(y= expression("Temperature Anomaly ("*~degree*F*")"),
      color = '')+
  scale_x_continuous("Year", labels = as.character(temp.select$Year), breaks = temp.select$Year)+
  scale_fill_manual(values=c(positive="firebrick1",negative="steelblue"))+
  theme(legend.position = 'none')

plot_grid(temp.line,
          temp.anom,
          label_x = 0.2,
          nrow = 2)
```

\newpage

##US Population

Population data retrieved from World Bank is at global scale covering 60 years since 1960. Therefore, both geograhic and temporal selection are needed to reframe the dataset. The sample of the wrangled dateset is shown as Table ???.
```{r warning=FALSE}
str(ppl)

#Reframe dataset to meet project objective
ppl.select <- ppl %>%
  select(Year, United.States) %>%
  filter(Year >1989 & Year < 2018)
dim(ppl.select)

#Rename column name for easier use
colnames(ppl.select)
ppl.select <- ppl.select %>%
  rename('US_pop' = United.States)
colnames(ppl.select)
```

```{r echo = FALSE, message=FALSE, warning=FALSE}
#Preview of reframed dataset
kable(head(ppl.select), caption = "First 6 years of US population in 1990-2017") %>%
  kable_styling(latex_options="hold_position")
```

```{r message = FALSE, warning = FALSE}
#Save all processed code to the Processed folder
write.csv(GDP.select, row.names = FALSE, file = './Processed Data/BEA_GDP_processed.csv')
write.csv(elec.select, row.names = FALSE, file = './Processed Data/EIA_electricity-consumption_sector_processed.csv')
write.csv(GHG.gas, row.names = FALSE, file = './Processed Data/EPA_GHG_Gas_processed.csv')
write.csv(GHG.sector.select, row.names = FALSE, file = './Processed Data/EPA_GHG_Sector_processed.csv')
write.csv(temp.select, row.names = FALSE, file = './Processed Data/NOAA_temp_processed.csv')
write.csv(ppl.select, row.names = FALSE, file = './Processed Data/WB_pop_processed.csv')

```

```{r message = FALSE, warning = FALSE}

#Reload new datasets.
newGDP <- read.csv('./Processed Data/BEA_GDP_processed.csv', head(T))
newelectricity <- read.csv('./Processed Data/EIA_electricity-consumption_sector_processed.csv', head(T))
newGHGgas <- read.csv('./Processed Data/EPA_GHG_Gas_processed.csv', head(T))
newGHGsector <- read.csv('./Processed Data/EPA_GHG_Sector_processed.csv', head(T))
newtemp <- read.csv('./Processed Data/NOAA_temp_processed.csv', head(T))
newpop <- read.csv('./Processed Data/WB_pop_processed.csv', head(T))

allGHG <- full_join(newGHGgas,newGHGsector, by = 'Year')
GHG_contribute <- full_join(newelectricity, newpop, by = 'Year')
GHG_impact <- full_join(newGDP, newtemp, by = 'Year')
```

\newpage

#Analysis
*Figures in this sections are disordered - the float package was not compatible to my system. Texts in this section will specify which figures are referring to in certain analyses.*

##Question 1: What factors have contributed to GHG emissions in these 28 years?

###Are emissions of different GHGs related to each other?
As discussed in Chapter 3, there is no general trend for the concentration of all GHGs. Therefore, before delving into external impacts on GHG concentrations, how different types of GHGs were varied from each other were first studied.

The distribution of all GHG data were assessed with shapiro.test. Most p-values are  greater than 0.05, which implies that the distribution of these data re not significantly different from normal distribution. Therefore, these data are normally distributed. Other data, namely CH4 and Fgas, obtain a p-value less than 0.05 (even transforming these two variables by taking the log and square root), which indicate they are not normally distributed. However, from the normal Q-Q plot, the scatters lie close to the line and symmetry across the qq normal line, so these two data can still be seen as normally distributed. All GHG emissions by sector obtain p-values greater than 0.05 from the shapiro.test, so they are normally distributed. Parametric tests will be used for all GHG dataset.

```{r include = FALSE}

summary(allGHG)

shapiro.test(allGHG$Total)
shapiro.test(allGHG$CO2)
shapiro.test(allGHG$CH4)
shapiro.test(allGHG$N2O)
shapiro.test(allGHG$Fgas)
shapiro.test(sqrt(allGHG$CH4))
shapiro.test(sqrt(allGHG$Fgas))
qqnorm(allGHG$CH4);qqline(allGHG$CH4)

shapiro.test(allGHG$Transportation)
shapiro.test(allGHG$Electricity_generation)
shapiro.test(allGHG$Industry)
shapiro.test(allGHG$Agriculture)
shapiro.test(allGHG$Commercial)
shapiro.test(allGHG$Residential)

```

Multiple Linear Regression was conducted between CO2 and other GHGs to see if there could be any relationships between CO2 and other GHGs, as there are always multiple GHGs emitted together from a source. The result illustartes that at least one of GHGs is significantly related to the CO2 emission (linear regression; R2=0.5562, dF = 24, p = 0.0001805). Specifically, changes in N2O emissions are significantly related to changes in CO2 emissions, while changes in CH4 and Fgas are not significantly related to CO2 emissions.

To step further, a correlation plot was created to reveal the possible relationships, as well as covariance among explanatory variables, as shown in Figure ???, in which blue indiates positively correlated and red indicate negatively correlated. The smaller ellipse indicates a higher correlationship between two variables, and the dark color implies a higher correlation cofficient. Therefore, both N2O and Fgas have positive correlationship with CO2, but N2O is more correlated and has a higher correlation coeffeicnt; on the other hand, CH4 has a negative correlationship with CO2 and such correlation is not significant as the ellipse is large. However, it is interesting to see CH4 and Fgas have a strong negative correlationship. Another format to observe the correlationship with CO2 concentration is shown in Figure ???.

Based on this reuslt, Akaike’s Information Criterion (AIC) were computed to improve the model to best predict impacts on CO2 emission, from which only N2O and CH4 were remained in the improved model (Step:  AIC=306.73). The improved model implies that both CH4 and N2O emissions are significantly related to CO2 emissions (linear regression; R2=0.5461, dF = 25, p < 0.0001).

```{r include = FALSE}
GHG.gas.regression <- lm(data=allGHG, CO2~ CH4+N2O+Fgas)
summary(GHG.gas.regression)
step(GHG.gas.regression)

GHG.gas.regression.improve <- lm(formula = CO2 ~ CH4 + N2O, data = allGHG)
summary(GHG.gas.regression.improve)

allGHG.bygas <- allGHG %>%
  select(CO2:Fgas)

#Visualize this result
allGHG.gas.corr <- cor(allGHG.bygas)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Correlation Plot of US GHG Concentration by Gas"}
corrplot(allGHG.gas.corr, method = "ellipse", tl.cex = 0.5)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Correlationships between CO2 and other GHGs"}
CO2byN2O <-ggplot(allGHG.bygas, aes(x = CO2, y = N2O)) +
  geom_point() +
  geom_smooth(method = 'lm', se = TRUE, color = "red")
CO2byCH4 <-ggplot(allGHG.bygas, aes(x = CO2, y = CH4)) +
  geom_point() +
  geom_smooth(method = 'lm', se = TRUE, color = "blue")
CO2byFgas <-ggplot(allGHG.bygas, aes(x = CO2, y = Fgas)) +
  geom_point() +
  geom_smooth(method = 'lm', se = TRUE, color = "pink")+
  labs(x=bquote(bold(~CO[2]~' Concentration (MMT'~CO[2]~'e)')))

plot_grid(CO2byCH4 + xlab(''), 
          CO2byN2O + xlab (''),
          CO2byFgas,
          nrow = 3, align = 'v')
```

\newpage
Similarly, multiple Linear Regression was aslo conducted among sectoral GHG emissions to see which sector is most significant to electricity generation sector, which has the highest GHG emission, as well as relying on electricity use.

The result illustartes that multiple sectors have significant relationships with electricity generation sector (linear regression; R2=0.8566, dF = 22, p < 0.0001). Specifically, emission changes in agriculture, commercial, and residential sectors are significantly related to emission changes in electricity generation sector, while changes in transporation and industry sectors are not significantly related to electricity generation emissions, which was also proved by AIC test that best model would be three significant explanatory variables.

As illustrated by the correlation plot in Figure ???, covariances among expanatory variables show interesting results. Transporation sector is more positively correlated to electricity generation than agriculture and residential sectors. Industry sector has litte correlation with electricity generation while commercial is negatively correlated. 

```{r include = FALSE}
GHG.regression <- lm(data=allGHG, Electricity_generation~Transportation+Industry+Agriculture+Commercial+Residential)
summary(GHG.regression)
step(GHG.regression)

allGHG.bysector <- allGHG %>%
  select(Transportation:Residential)
allGHG.corr <- cor(allGHG.bysector)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Correlation Plot of US GHG Emission by Sector"}
corrplot(allGHG.corr, method = "ellipse", tl.cex = 0.5)
```

\newpage

###Did total electricity consumption differ among sectors?
The first impact factor on GHG emissions to study is the domestic electricity consumption. Similar to previous sections, there was no general consumption trend among sectors, a detailed exploration on electricity consumption dataset was first conducted. Specifically, this section addresses on if electricity consumptions were significantly different among various sectors.

First, all data were gathered by sector and tested for the normality. The normal Q-Q plot shows that the emissions are normally distributed. Then, one-way Anova was tested, reflecting that electricity consumptions were significantly differed among various sectors (ANOVA, R2=0.2598, dF = 81, p < 0.0001). A post-hoc test was then run to look at the pairwise differences, and the result was shown as Figure ???.

```{r include = FALSE}
newelectricity.select <- newelectricity %>%
  select(Year, elec_residential, elec_commercial, elec_industrial)
  
newelectricity.gather <- gather(newelectricity.select, 'Sector', 'Consumption', -Year)
count(newelectricity.gather)

newelectricity.gather$Consumption <- str_replace_all(newelectricity.gather$Consumption,
pattern = "([,])", replacement = "")
newelectricity.gather$Consumption <- as.numeric(newelectricity.gather$Consumption)
str(newelectricity.gather)

#test for normality
qqnorm(newelectricity.gather$Consumption); qqline(newelectricity.gather$Consumption)

newelectricity.anova <- aov(data = newelectricity.gather, Consumption ~ Sector)
summary(newelectricity.anova)
newelectricity.anova2 <- lm(data = newelectricity.gather, Consumption ~ Sector)
summary(newelectricity.anova2)


# Post-hoc test # Run a post-hoc test for pairwise differences
TukeyHSD(newelectricity.anova)

#Extract groupings for pairwise relationships
newelectricity.groups <- HSD.test(newelectricity.anova, "Sector", group = TRUE)
newelectricity.groups

```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Post-hoc Test Plot - Pairwise Relationship between Emissions and Sectors"}

newelectricity.graph <- ggplot(newelectricity.gather, aes(x = Sector, y = Consumption)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) + stat_summary(geom = "text", fun.y = max, vjust = -1, size = 3.5, label = c('b','c','a')) +
  labs(x = "Sector", y= 'Electricity Consumption (Mwh)')
print(newelectricity.graph)

```

\newpage

### Were electricity comsupmtions significant to total GHG emissions?
This section answers the first question in the introduction - if the electricity consumption was significant to total GHG emissions. A multiple linear regression was run to see the relationship. The result shows that there is no significant relationship between electricity consumption and total GHG concentrations (linear regression, R2=0.2623, dF = 24, p = 0.05896), among which elec_industrial sector is the only significant variable. Since the p-value is close to 0.05 significane level, the AIC test was conducted to see the better model. The improve model from the test is the test between the total GHG emission and electricity consumption in industiral sector (Step:  AIC=321.5), and the result from the linera regression also indicates the significant relationship between them (linear regression, R2=0.1774, dF = 26, p = 0.0214). 

The covariance of three explanatroy data with total GHG concentration are illustrated in Figure ???, in which commerncial electricity consumption data and residential electricity consumption data are away from the respective regression line, which results in the insignificant relationship with total GHG concentration.


```{r include = FALSE}
##linear regression - electricity consumption relation to total GHG emissions
GHG_contribute$elec_residential <- str_replace_all(GHG_contribute$elec_residential,
pattern = "([,])", replacement = "")
GHG_contribute$elec_residential <- as.numeric(GHG_contribute$elec_residential)
GHG_contribute$elec_commercial <- str_replace_all(GHG_contribute$elec_commercial,
pattern = "([,])", replacement = "")
GHG_contribute$elec_commercial <- as.numeric(GHG_contribute$elec_commercial)
GHG_contribute$elec_industrial <- str_replace_all(GHG_contribute$elec_industrial,
pattern = "([,])", replacement = "")
GHG_contribute$elec_industrial <- as.numeric(GHG_contribute$elec_industrial)

elec.regression <- lm(allGHG$Total ~GHG_contribute$elec_residential + GHG_contribute$elec_commercial + GHG_contribute$elec_industrial)
summary(elec.regression)

step(elec.regression)

elecmodel <- lm(formula = allGHG$Total ~ GHG_contribute$elec_industrial)
summary(elecmodel)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Relationships between Total GHG Emissions and Electricity Consumptions"}
newelectricity.gather_full <- full_join(allGHG, newelectricity.gather, by='Year')

GHGbyelec <-ggplot(newelectricity.gather_full, aes(x = Total, y = Consumption, color = Sector, shape = Sector)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE)+
  labs(x=bquote(bold('Total GHG Emissions (MMT'~CO[2]~'e)')), y='Electricity Consumption (Mwh)')+
  scale_shape_manual(values=c(3, 16, 17))+ 
  scale_color_manual(values=c('#999999','#E69F00', '#56B4E9'))
print(GHGbyelec)
```

\newpage

###Is population growth significant to total GHG concentration?
Another factor that might affect GHG concentration attributed to human activities is population growth. This question was inspired by observing from the increasing trend of both GHG emissions and population. The shapiro test shows that the population data is normally distributed (W = 0.95398, p-value = 0.249). Then, a simple linear regression was conducted, which illustates there is no significant relationship between total GHG emissions and population growth (linear regression, R2 = 0.0007, dF = 26, p = 0.8948). The relationship between these two variables is displayed in Figure ???, which is not in a linear relationship.

```{r include = FALSE}
shapiro.test(GHG_contribute$US_pop)

pop.regression <- lm(allGHG$Total ~GHG_contribute$US_pop)
summary(pop.regression)
```


```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Relationship between Population and Total GHG Emissions"}

ppl.all <- full_join(allGHG, newpop, by = 'Year')
# Plot the regression
GHGpop.plot <-ggplot(ppl.all, aes(x = US_pop, y = Total)) + 
  geom_line()+
  geom_smooth(method ='lm')+
  labs(y= bquote(bold('Total GHG Emission (MMT'~CO[2]~'e)')),
       x= 'Population',
       color = '')
print(GHGpop.plot)

```

\newpage

##Question 2: What were impacts of GHG emissions in these 28 years?

### Which sectors of GHG emissions were significant to temperature anomaly?
Temperature is one of the most explicit impacts of GHG emissions. Instead of looking at sepcific types of GHGs, this project addresses on the impacts of sectoral emissions on temperature change, and aims to figure out which sector was more significant to the temperature. 

The first step to achieve such goal was to study the chaning trend of temperature, specifically conducting a timer series analysis to see how the temperature had change over the 28-year period in US. The result shows that there was no significant trend of temperature change over the period of 1990-2017 in US (Mann-Kendall trend test z=1.758, p-value = 0.07869).

Then, the shapiro.test was conducted to confirm the normality of temperature anomaly data for the preparation o linear regression (W = 0.98866, p-value = 0.9863). The result from the multiple linear regression illustartes that there was a significant relationship between temperature anomaly and sectoral emissions (linear regression, R2 = 0.8219, dF = 21, p < 0.0001). Specifically, emissions from transporation sector, agriculture sector, and residential sector were significant to such change. An AIC test were computed to improve the model to best illustrate explanatory variables in such relationship, and the improved model includes transportation, agiculture, commercial, and residential sectors (Step:  AIC=-42.11). The multiple linear regression result proves that all of these sectoral emissions were significant to temperature anomaly (linear regression, R2 = 0.816, dF = 23, p < 0.0001). 

A correlation plot was then created to visualized the correlationship and covariance between these variables. As shown in Figure ???, residential emissions and commercial emissions were mroe correlated to temperature anomaly changes in a negative trend, while transportation emission and agriculture emissions were correlated to temperature anomaly in a positive trend.

```{r include = FALSE}
GHGtemp_data<- full_join(allGHG, newtemp, by='Year')
GHGtemp.ts <- ts(GHGtemp_data$Value, start=c(1990), end=c(2017), frequency=1)
class(GHGtemp.ts)
GHGtemp.ts.vector <- as.numeric(GHGtemp.ts)
class(GHGtemp.ts.vector)
GHGtemp.trend <- mmkh(GHGtemp.ts.vector, ci=0.95)
GHGtemp.trend

shapiro.test(newtemp$Anomaly)
GHG.temp.regression <- lm(GHGtemp_data,formula = Anomaly~  Transportation+Electricity_generation+Industry+Agriculture+Commercial+Residential)
summary(GHG.temp.regression)

step(GHG.temp.regression)

GHG.temp.regression.improve <- lm(formula = Anomaly ~ Transportation + Agriculture + Commercial + Residential, data = GHGtemp_data)
summary(GHG.temp.regression.improve)

GHGsector.temp <- GHGtemp_data %>%
  select(Transportation:Residential, Anomaly)
GHGsector.temp.corr <- cor(GHGsector.temp)
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Correlation Plot between US Mean Annual Temperature and Sectoral GHG Emissions"}
corrplot(GHGsector.temp.corr, method = "ellipse", tl.cex = 0.5)
```

### Was total GHG emissions significant to GDP growth?
As most GHGs were emitted by human activities, were such emissions significant to economic development? In this proejct, GDP was selected as the parameter to assess economic development. A similar time series analysis was conducted to assess if GDP had change over the study period in US. The result shows that there a significant increasing trend of GDP change over the period of 1990-2017 in US (Mann-Kendall trend test z= 5.05, p-value < 0.0001).

GDP data was normally distributed according to shapio.test (W = 0.9486, p-value = 0.1827). However, there was no significant relationship between total GHG emissions and GDP growth over the time (linear regression, R2 = 0.0004, dF = 26, p = 0.7499). Such result was visualized in Figure ???, which illustrates that variables were dispersed away from the linear trend line.

```{r include = FALSE}
GHGgdp_data<- full_join(allGHG, newGDP, by='Year')
GHGgdp.ts <- ts(GHGgdp_data$GDP, start=c(1990), end=c(2017), frequency=1)
class(GHGgdp.ts)
GHGgdp.ts.vector <- as.numeric(GHGgdp.ts)
class(GHGgdp.ts.vector)
GHGgdp.trend <- mmkh(GHGgdp.ts.vector, ci=0.95)
GHGgdp.trend
summary(GHGtemp.trend)

shapiro.test(newGDP$GDP)
GDP.anova <- lm(data=GHGgdp_data, Total~GDP)
summary(GDP.anova) 
```

```{r echo = FALSE, message=FALSE, warning=FALSE, fig.cap= "Relationship between US GDP and Total GHG Emissions"}
GHGgdp.plot <- ggplot(GHGgdp_data, aes(x = Total, y = GDP)) + 
  geom_smooth(method = "lm") +
  labs(y= 'GDP (US$ billion)', x= bquote(bold('Total GHG Emission (MMT'~CO[2]~'e)')))+
  geom_point()
print(GHGgdp.plot)
```

\newpage

# Summary and Conclusions

As Global Warming is a more server problem, GHG emissions as one of the most responsible factors are addressing more people's attention. This project studies the factors that might contribute to GHG emissions and also the potential impacts of GHG emission in US from 1990-2017. 

The first part of project looks at the electricity consumption of which sector is significant to total GHG emissions and examines if population growth is significant to total GHG emission during this period. The tests from linear regression reveal that industrial electricity consumption is significant to total GHG emissions, and there is no significant relationship between population growth and total GHG emissions. In this section, the relationships among different types of GHGs as well as the relationships among sectoral emissions were also explored. By running different types of generalized linear models, the results illustrate that:
1. CH4 and N2O emissions are significantly related to CO2 emissions;
2. CH4 and Fgas are strongly correlated;
3. Emissions in agriculture, commercial, and residential sectors are significantly related to emissions in electricity generation sector;
4. Electricity consumptions are significantly different among various sectors.

The second part analyzes the potential impacts of GHG emissions, specifically referring to temperature anomaly changes and GDP growth. Time series analysis was first conducted to evaluate how these two variables have changed over time, and the results demonstrated that there was no significant trend of temperature, and there was a significant increasing trend of GDP over 28 years. For temperature change, emissions in transportation, agiculture, commercial, and residential sectors were most significant to temperature anomalies; however, there was no significant relationship between total GHG emissions and GDP growth over the period.

This project is still a prelinary research on analyzing factors and impacts GHG emissions with many limitations. For example, the temporal range - 28 years - is short. Such factor was restricted by the data availability, while the GHG emissions always have a lag effects; that says, the impacts of GHG emissions, especially on temperature change, will not be revealed immediately. Also, the study on temperature change should be considered at a long-term scale, i.e. from pre-industrial period. Also, the geographic scale is also too broad. Different states in US have their only regulatories on GHG emissions, such as California as a leader on reducing GHG emissions over a long time. The analysis at the national level cannot illustrte the progress of policy inplementation. However, this project is still helpful to learn from the past about the causes and consequences of GHG emissions, as a reference as well as a warning to decision markers to think about the environmental impacts of emissions in the future.
